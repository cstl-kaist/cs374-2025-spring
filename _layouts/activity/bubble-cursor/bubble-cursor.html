<html>
    <head>
        <title>Bubble Cursor</title>
        <meta charset="utf-8">
        <script type="text/javascript" src="https://d3js.org/d3.v3.js"></script>
    </head>
    <body data-new-gr-c-s-check-loaded="14.1229.0" data-gr-ext-installed="">
        <h1>Bubble Cursor</h1>
        <h3>A bubble Cursor, based on the 2005 paper "The bubble cursor: enhancing target acquisition by dynamic resizing of the cursor's activation area" by Grossman and Balakrishnan.</h3>
        <h3>Refresh to redraw the targets.</h3>
        
        <div id="bubbleCursor">
        <script>
    
        // Number of targets
        var numTargets = 40;
        // Min/Max radius of targets
        var minRadius = 10, maxRadius = 30;
        // Min separation between targets
        var minSep = 20;
    
        var w = 960, h = 500;
        var svg = d3.select("#bubbleCursor")
        .append("svg:svg")
        .attr("width", w)
        .attr("height", h);
    
        // Make a white background rectangle
        svg.append("rect")
        .attr("class","backgroundRect")
        .attr("width", w)
        .attr("height", h)
        .attr("fill","white");
    
    
        function distance(ptA,ptB) {
            var diff = [ptB[0]-ptA[0],ptB[1]-ptA[1]];
            return Math.sqrt(diff[0]*diff[0] + diff[1]*diff[1]);
        }
    
        // Initialize position and radius of all targets.
        function initTargets(numTargets,minRadius,maxRadius,minSep) {
            var radRange = maxRadius - minRadius;
            var minX = maxRadius + 10, maxX = w-maxRadius-10, xRange = maxX-minX;
            var minY = maxRadius + 10, maxY = h-maxRadius-10, yRange = maxY-minY;
    
            // Make a vertices array storing position and radius of each
            // target point.
            var targets = [];
            for (var i = 0; i<numTargets;i++) {
            var ptCollision = true;
            while (ptCollision) {
                // Randomly choose position and radius of new target pt.
                var pt = [Math.random() * xRange + minX,
                Math.random() * yRange + minY];
                var rad = Math.random()*radRange+minRadius;
    
                // Check for collisions with all targets made earlier.
                ptCollision = false;
                for(var j = 0; j < targets.length && !ptCollision; j++) {
                var ptJ = targets[j][0]
                var radPtJ = targets[j][1];
                var separation = distance(pt,ptJ);
                if (separation < (rad+radPtJ+minSep)) {
                    ptCollision = true;
                }
                }
    
                if(!ptCollision) {
                targets.push([pt,rad]);
                }
            }
            }
    
            return targets;
        }
    
    
        function updateTargetsFill(currentCapturedTarget,clickTarget) {
            // Update the fillcolor of the targetcircles
            svg.selectAll(".targetCircles")
                .attr("fill",function(d,i){
                var clr = "white";
                if(i === currentCapturedTarget) {
                clr = "limegreen";
                }
                if(i === clickTarget)
                clr = "salmon";
                return clr;
            });
            
        }
    
        function getTargetCapturedByBubbleCursor(mouse,targets) {
            // Compute distances from mouse to center, outermost, innermost
            // of each target and find currMinIdx and secondMinIdx;
            var mousePt = [mouse[0],mouse[1]];
            var dists=[], containDists=[], intersectDists=[];
            var currMinIdx = 0;
            for (var idx =0; idx < numTargets; idx++) {
            var targetPt = targets[idx][0];
            var currDist = distance(mousePt,targetPt);
            dists.push(currDist);
    
            targetRadius = targets[idx][1];
            containDists.push(currDist+targetRadius);
            intersectDists.push(currDist-targetRadius);
    
            
            if(intersectDists[idx] < intersectDists[currMinIdx]) {
                currMinIdx = idx;
                
            } 
            }
            
            // Find secondMinIdx
            var secondMinIdx = (currMinIdx+1)%numTargets;
            for (var idx =0; idx < numTargets; idx++) {
            if (idx != currMinIdx && 
                intersectDists[idx] < intersectDists[secondMinIdx]) {
                secondMinIdx = idx;
            }
            }
    
            var cursorRadius = Math.min(containDists[currMinIdx],
                        intersectDists[secondMinIdx]);
            svg.select(".cursorCircle")
            .attr("cx",mouse[0])
            .attr("cy",mouse[1])
            .attr("r",cursorRadius);
    
            if(cursorRadius < containDists[currMinIdx]) {
            svg.select(".cursorMorphCircle")
                .attr("cx",targets[currMinIdx][0][0])
                .attr("cy",targets[currMinIdx][0][1])
                .attr("r",targets[currMinIdx][1]+5);
            } else {
            svg.select(".cursorMorphCircle")
                .attr("cx",0)
                .attr("cy",0)
                .attr("r",0);
            }
    
            return currMinIdx;
        }
    
        // Make the targets
        var targets = initTargets(numTargets,minRadius,maxRadius,minSep);
        // Choose the target that should be clicked
        var clickTarget = Math.floor(Math.random()*targets.length);
    
    
        // Add in the cursor circle at 0,0 with 0 radius
        // We add it first so that it appears behind the targets
        svg.append("circle")
        .attr("class","cursorCircle")
        .attr("cx",0)
        .attr("cy",0)
        .attr("r",0)
        .attr("fill","lightgray");
    
        // Add in cursorMorph circle  at 0,0 with 0 radius
        // We add it first so that it appears behind the targets
        svg.append("circle")
        .attr("class","cursorMorphCircle")
        .attr("cx",0)
        .attr("cy",0)
        .attr("r",0)
        .attr("fill","lightgray");
    
        // Add in the target circles
        svg.selectAll("targetCircles")
        .data(targets)
        .enter()
        .append("circle")
        .attr("class","targetCircles")
        .attr("cx",function(d,i){return d[0][0];})
        .attr("cy",function(d,i){return d[0][1];})
        .attr("r",function(d,i){return d[1]-1;})
        .attr("stroke-width",2)
        .attr("stroke","limegreen")
        .attr("fill","white");
    
        // Update the fill color of the targets
        updateTargetsFill(-1,clickTarget);
    
        //Handle mousemove events
        svg.on("mousemove", function(d,i) {
            var capturedTargetIdx = 
            getTargetCapturedByBubbleCursor(d3.mouse(this),targets);
            
            // Update the fillcolor of the targetcircles
            updateTargetsFill(capturedTargetIdx,clickTarget);
        });
    
        // Handle mouse moving outside of svg window. 
        svg.on("mouseout", function(d,i) {
            // Update the fillcolor of the targetcircles
            updateTargetsFill(-1,clickTarget);
    
            // Get rid of the grady cursor circles by setting size and pos to 0
            svg.select(".cursorCircle")
            .attr("cx",0)
            .attr("cy",0)
            .attr("r",0);
    
            svg.select(".cursorMorphCircle")
            .attr("cx",0)
            .attr("cy",0)
            .attr("r",0);
        });
    
        // Handle a mouse click
        svg.on("click", function(d,i) {
            var capturedTargetIdx = 
            getTargetCapturedByBubbleCursor(d3.mouse(this),targets);
    
            // If user clicked on the clickTarget then choose a new clickTarget
            if(capturedTargetIdx == clickTarget) {
            var newClickTarget = clickTarget;
            // Make sure newClickTarget is not the same as the current clickTarget
            while (newClickTarget == clickTarget)
                newClickTarget = Math.floor(Math.random()*targets.length);
            clickTarget = newClickTarget;
    
            // Update drawing of targets
            updateTargetsFill(capturedTargetIdx,clickTarget);
            }
    
        });
    
        </script><svg width="960" height="500"><rect class="backgroundRect" width="960" height="500" fill="white"></rect><circle class="cursorCircle" cx="0" cy="0" r="0" fill="lightgray"></circle><circle class="cursorMorphCircle" cx="0" cy="0" r="0" fill="lightgray"></circle><circle class="targetCircles" cx="455.16713662759884" cy="157.37837338185437" r="15.871834776552681" stroke-width="2" stroke="limegreen" fill="white"></circle><circle class="targetCircles" cx="275.39419756083157" cy="47.09748019556166" r="23.69952579639758" stroke-width="2" stroke="limegreen" fill="white"></circle><circle class="targetCircles" cx="47.31410032697429" cy="196.9345271787435" r="15.942296078044933" stroke-width="2" stroke="limegreen" fill="white"></circle><circle class="targetCircles" cx="179.1062071007584" cy="404.56690627071276" r="27.91603712347718" stroke-width="2" stroke="limegreen" fill="white"></circle><circle class="targetCircles" cx="327.51260268693585" cy="325.91741155096264" r="11.861783143775018" stroke-width="2" stroke="limegreen" fill="white"></circle><circle class="targetCircles" cx="122.35068082263011" cy="227.59407599635554" r="18.204151783603052" stroke-width="2" stroke="limegreen" fill="white"></circle><circle class="targetCircles" cx="861.4432147089844" cy="391.56485403052665" r="27.336531687951734" stroke-width="2" stroke="limegreen" fill="white"></circle><circle class="targetCircles" cx="699.4677699575284" cy="259.8298719139392" r="24.224354201736272" stroke-width="2" stroke="limegreen" fill="white"></circle><circle class="targetCircles" cx="915.5888554986425" cy="444.63740500265214" r="10.09695201855613" stroke-width="2" stroke="limegreen" fill="white"></circle><circle class="targetCircles" cx="780.4712777308494" cy="174.90132911585118" r="9.07619267012117" stroke-width="2" stroke="limegreen" fill="white"></circle><circle class="targetCircles" cx="464.80548644896584" cy="69.57227622929375" r="10.89694987456543" stroke-width="2" stroke="limegreen" fill="white"></circle><circle class="targetCircles" cx="907.2970444908586" cy="237.77184686279023" r="23.630201454363714" stroke-width="2" stroke="limegreen" fill="white"></circle><circle class="targetCircles" cx="535.2916687124526" cy="291.21867337316894" r="26.473892780267487" stroke-width="2" stroke="limegreen" fill="white"></circle><circle class="targetCircles" cx="216.1000638142015" cy="296.57553736072305" r="13.678987457787777" stroke-width="2" stroke="limegreen" fill="white"></circle><circle class="targetCircles" cx="751.1985034937925" cy="407.4912581172764" r="17.567460744655605" stroke-width="2" stroke="limegreen" fill="white"></circle><circle class="targetCircles" cx="110.91036009214412" cy="359.8027702361224" r="19.576561386607217" stroke-width="2" stroke="limegreen" fill="white"></circle><circle class="targetCircles" cx="175.28026816350763" cy="144.43035863206626" r="23.97395194452178" stroke-width="2" stroke="limegreen" fill="white"></circle><circle class="targetCircles" cx="427.98440277787057" cy="308.55989253841847" r="18.586009177031304" stroke-width="2" stroke="limegreen" fill="white"></circle><circle class="targetCircles" cx="430.56236960620026" cy="421.50642475449365" r="23.256880724971296" stroke-width="2" stroke="limegreen" fill="white"></circle><circle class="targetCircles" cx="327.3219449507317" cy="438.5164687430701" r="20.11029430539942" stroke-width="2" stroke="limegreen" fill="salmon"></circle><circle class="targetCircles" cx="292.7858285158785" cy="130.14044474299084" r="9.490914519775568" stroke-width="2" stroke="limegreen" fill="white"></circle><circle class="targetCircles" cx="703.3593231810262" cy="345.40641572535236" r="19.267720163696225" stroke-width="2" stroke="limegreen" fill="white"></circle><circle class="targetCircles" cx="56.50731032767691" cy="301.8111766425425" r="21.85801946930316" stroke-width="2" stroke="limegreen" fill="white"></circle><circle class="targetCircles" cx="254.6404274301795" cy="355.0964090558981" r="27.177750323210038" stroke-width="2" stroke="limegreen" fill="white"></circle><circle class="targetCircles" cx="65.92752151730551" cy="457.98824613051306" r="28.41423417811603" stroke-width="2" stroke="limegreen" fill="white"></circle><circle class="targetCircles" cx="649.5869051598457" cy="154.4349479464025" r="12.592109321008735" stroke-width="2" stroke="limegreen" fill="white"></circle><circle class="targetCircles" cx="207.61711320566886" cy="237.16981512201164" r="22.059308377723706" stroke-width="2" stroke="limegreen" fill="white"></circle><circle class="targetCircles" cx="99.76011150799638" cy="139.79687063957914" r="27.467723744306262" stroke-width="2" stroke="limegreen" fill="white"></circle><circle class="targetCircles" cx="489.95975896620365" cy="392.1492226197653" r="16.655733132248645" stroke-width="2" stroke="limegreen" fill="white"></circle><circle class="targetCircles" cx="539.233183627166" cy="154.1098628580754" r="19.088063083486393" stroke-width="2" stroke="limegreen" fill="white"></circle><circle class="targetCircles" cx="590.1299126093322" cy="451.3741946536987" r="11.105036380462849" stroke-width="2" stroke="limegreen" fill="white"></circle><circle class="targetCircles" cx="612.1525106135998" cy="59.41940311771532" r="15.171412201138896" stroke-width="2" stroke="limegreen" fill="white"></circle><circle class="targetCircles" cx="817.2049773017296" cy="97.04952312705436" r="16.485331586321173" stroke-width="2" stroke="limegreen" fill="white"></circle><circle class="targetCircles" cx="830.1896053992195" cy="320.5517349241792" r="15.760554540361792" stroke-width="2" stroke="limegreen" fill="white"></circle><circle class="targetCircles" cx="542.8927869021188" cy="422.85998355864996" r="13.627898337057136" stroke-width="2" stroke="limegreen" fill="white"></circle><circle class="targetCircles" cx="827.7604043563665" cy="197.6339687985406" r="13.920856317136053" stroke-width="2" stroke="limegreen" fill="white"></circle><circle class="targetCircles" cx="49.805832057481055" cy="379.8088968640344" r="13.704770911397329" stroke-width="2" stroke="limegreen" fill="white"></circle><circle class="targetCircles" cx="768.5015435678364" cy="272.4280623740334" r="22.739542827071617" stroke-width="2" stroke="limegreen" fill="white"></circle><circle class="targetCircles" cx="247.55275669713575" cy="170.9720789519543" r="24.005661730213475" stroke-width="2" stroke="limegreen" fill="white"></circle><circle class="targetCircles" cx="160.15138434467556" cy="69.29493947283032" r="10.881740495780369" stroke-width="2" stroke="limegreen" fill="white"></circle></svg>
        </div>
  </body>
</html>